<!DOCTYPE html>
<html>
	<head>
		<script>
			var gaTrackingId = 'UA-117108133-1';
		</script>

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117108133-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', gaTrackingId, { 'send_page_view': false });
		</script>

		<meta charset="utf-8">
		<title>Hardpoint - Star Citizen ship fitting and comparison tool</title>
		<meta name="description" content="Web application for planning and comparing loadouts of Star Citizen ships with detailed component breakdown and summary statistics." />
		<meta name="keywords" content="star citizen,sc,cig,ship,vehicle,spaceship,loadout,fitting,equipment,gear,items,tool,planner,app,theory,comparison" />

		<script src="//unpkg.com/lodash"></script>
		<script src="//unpkg.com/clipboard@2.0.0/dist/clipboard.min.js"></script>

		<link rel="stylesheet" href="//unpkg.com/iview/dist/styles/iview.css">

		<script src="//unpkg.com/vue"></script>
		<script src="//unpkg.com/vue-router/dist/vue-router.js"></script>
		<script src="//unpkg.com/iview/dist/iview.min.js"></script>
		<script src="//unpkg.com/iview/dist/locale/en-US.js"></script>
		<script>
			iview.lang('en-US');
		</script>

		<script src="data/vehicles.js"></script>
		<script src="data/items.js"></script>
		<script src="data/meta.js"></script>

		<script src="data/overrides.js"></script>

		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<div id="app">
			<div class="not-footer">
				<div class="header">
					<div class="centered-narrow">
						<row>
							<i-col span="12">
								<router-link to="/">
									<h1>Hardpoint</h1>
								</router-link>
								<p>Game Data Version {{ gameDataVersion }}</p>
							</i-col>
							<i-col span="12">
								<i-menu mode="horizontal" theme="dark" @on-select="onNavigationSelect">
									<menu-item name="comparison">
										Ship Comparison
									</menu-item>
									<menu-item name="saved">
										Saved Loadouts
									</menu-item>
									<submenu name="new-loadout">
										<template slot="title">
											New Loadout
										</template>
										<menu-item
											v-for="customization in shipCustomizations"
											:key="customization.serialize()"
											:name="customization.serialize()">
											{{customization.displayName}}
										</menu-item>
									</submenu>
								</i-menu>
							</i-col>
						</row>
					</div>
				</div>
				<div class="content">
					<div class="centered-narrow">
						<router-view :key="$route.fullPath"></router-view>
					</div>
				</div>
			</div>
			<div class="footer">
				<div class="centered-narrow">
					<p>Star Citizen intellectual property, content and trademarks are owned by Cloud Imperium Games Corporation and its subsidiaries.</p>
					<p>Thanks to <a href="http://starcitizendb.com/">StarCitizenDB</a> for the data and <a href="https://github.com/">GitHub</a> for the hosting!</p>
				</div>
			</div>
		</div>

		<template id="ship-list">
			<div class="ship-list">
				<row class="spaced-row ship-list-controls">
					<i-col span="8">
						<i-input placeholder="Search" clearable v-model="searchInput"></i-input>
					</i-col>
					<i-col span="16" class="right">
						<i-button type="primary" @click="onCompareSelected" :disabled="compareDisabled">
							{{comparing ? "Show All" : "Compare Selected"}}
						</i-button>
					</i-col>
				</row>
				<row class="spaced-row">
					<i-col span="24">
						<i-table
							ref="table"
							:columns="attributeColumns"
							:data="shipAttributes"
							:height="tableHeight"
							highlight-row
							stripe>
						</i-table>
					</i-col>
				</row>
			</div>
		</template>

		<template id="item-port-group">
			<div class="item-port-group">
				<div class="group-row">
					<div class="group-indicator" :class="{'group-indicator-border': linkable}">
						<div class="group-indicator-label" v-if="linkable">
							<p v-if="linked">
								{{ prototypeGroup.members.length }}x
							</p>
							<i-button type="primary" size="small" @click="onClick">
								{{ buttonText }}
							</i-button>
						</div>
					</div>
					<div class="group-content">
						<div class="group-content-entry" v-for="map in getBindingMap()">
							<slot
								:prototype-binding="map.prototypeBinding"
								:target-bindings="map.targetBindings">
							</slot>
						</div>
					</div>
				</div>
			</div>
		</template>

		<template id="ship-details">
			<div class="ship-details">
				<row class="spaced-row">
					<i-col span="14">
						<h1>
							{{selectedCustomization.displayName}}
							<span v-if="selectedCustomization.storageKey">/ {{selectedCustomization.name}}</span>
						</h1>
						<br />
						<p>Specifications for this ship are based on <a :href="scdbLink">current game data</a> not future plans</p>
						<p>Additional information available on the <a :href="wikiLink">Star Citizen wiki</a></p>
					</i-col>
					<i-col span="10">
						<div class="horizontal-buttons right">
							<i-button class="clipboard-button" type="primary">
								Copy Shareable Link
							</i-button><i-button type="primary" @click="onOpenModal">
								{{modalTitle}}
							</i-button><i-button
								v-if="selectedCustomization.storageKey"
								type="error"
								icon="md-trash"
								class="large-icon-button"
								@click="onClickDelete">
							</i-button>
						</div>
						<modal :title="modalTitle" v-model="showModal" :mask-closable="false">
							<p>Loadout will be saved in browser local storage and won't be available elsewhere.</p>
							<br />
							<p><strong>Name</strong></p>
							<i-input v-model="loadoutName"></i-input>
							<div slot="footer" class="horizontal-buttons">
								<i-button size="large" @click="onCancelModal">
									Cancel
								</i-button><i-button type="primary" size="large" @click="onConfirmModal">
									{{modalAction}}
								</i-button>
							</div>
						</modal>
					</i-col>
				</row>
				<row class="spaced-row" :gutter="16">
					<i-col span="17">
						<collapse v-model="expandedSections">
							<panel v-for="sectionName in sectionNames" :key="sectionName" :name="sectionName">
								{{sectionName}}
								<div slot="content">
									<item-port-group
										v-for="group in getSectionBindingGroups(sectionName)"
										:key="JSON.stringify(selectedCustomization.shipId) + JSON.stringify(group.memberPortNames)"
										:customization="selectedCustomization"
										:group-name="group.name">
										<template slot-scope="parent">
											<div class="component-and-children-selector">
												<component-selector
													:customization="selectedCustomization"
													:bindings="parent.targetBindings">
												</component-selector>
												<item-port-group
													v-for="childGroup in getChildBindingGroups(parent.prototypeBinding)"
													:key="JSON.stringify(selectedCustomization.shipId) +
														JSON.stringify(parent.prototypeBinding.selectedComponent) +
														JSON.stringify(parent.targetBindings.map(b => b.port.name)) +
														JSON.stringify(childGroup.memberPortNames)"
													:customization="selectedCustomization"
													:group-name="childGroup.name"
													:parent-bindings="parent.targetBindings">
													<template slot-scope="child">
														<component-selector
															:customization="selectedCustomization"
															:bindings="child.targetBindings">
														</component-selector>
													</template>
												</item-port-group>
											</div>
										</template>
									</item-port-group>
								</div>
							</panel>
						</collapse>
					</i-col>
					<i-col span="7">
						<i-table :columns="damageColumns" :data="selectedCustomization.getAttributes('Damage')"></i-table>
						<i-table :columns="maneuverabilityColumns" :data="selectedCustomization.getAttributes('Maneuverability')"></i-table>
						<i-table :columns="survivabilityColumns" :data="selectedCustomization.getAttributes('Survivability')"></i-table>
						<i-table :columns="travelColumns" :data="selectedCustomization.getAttributes('Travel')"></i-table>
					</i-col>
				</row>
			</div>
		</template>

		<template id="component-display">
			<i-button :disabled="disabled">
				<!-- Gutters in nested rows are broken; they intermittently inherit the setting from their ancestors. -->
				<!-- Setting identical gutter on the child rows seems to at least make the behavior consistent.  -->
				<row v-if="componentName==undefined" :gutter="16" style="text-align: center;">
					Empty
				</row>
				<row v-if="componentName" :gutter="16">
					<i-col span="12">
						<strong>{{component.displayName}}</strong>
					</i-col>
					<i-col span="12" class="right">
						{{component.type}}
					</i-col>
				</row>
				<row v-if="componentName" :gutter="16">
					<i-col span="12">
						<span v-html="component.summary.render()"></span>
					</i-col>
						<i-col span="12" class="right">
						Size {{component.size}}
					</i-col>
				</row>
			</i-button>
		</template>

		<template id="component-selector">
			<div class="component-selector">
				{{label}}
				<br />
				<dropdown
					ref="dropdown"
					:trigger="bindings[0].port.editable ? 'click' : 'custom'"
					class="component-selector"
					@on-visible-change="onVisibleChange"
					@on-click="onClick">

					<component-display :component-name="selectedComponentName" :disabled="!bindings[0].port.editable">
					</component-display>
					<span :class="{'flip-icon': visible}"><i class="ivu-icon ivu-icon-arrow-down-b ivu-select-arrow"></i></span>

					<dropdown-menu slot="list">
						<dropdown-item v-for="componentName in availableComponents" :name="componentName" :key="componentName">
							<component-display :component-name="componentName">
							</component-display>
						</dropdown-item>
					</dropdown-menu>
				</dropdown>
			</div>
		</template>

		<script src="code.js"></script>
	</body>
</html>